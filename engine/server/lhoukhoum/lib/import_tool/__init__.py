import time
import pandas
import requests

from ..trainline import *
import datetime

_STOP_LIST =[87113001,87212027,87182014,87214056,87171926,87147322,87193003,87192039,87191007,87722025,87723197,87694109,87111849,87141002,87182063,87300822,87300863,87713040,87725689,87775007,87773002,87318964,87319012,87751008,87725002,87763029,87713545,87756056,87757674,87757625,87757526,87755447,87755009,87144451,87144006,87144014,87141150,87212225,87215012,87174003,87174276,87175042,87171009,87172270,87172007,87172254,87223263,87313882,87271494,87342014,87703975,87688887,87773200,87781278,87781005,87781104,87784009,87286005,87713131,87345009,87393702,87571240,87575001,87583005,87581009,87396002,87484006,87481002,87471003,87478404,87413013,87411017,87381509,87393009,87393579,87487603,87142109,87686006,87755629,87762906,87756486,87761007,87764001,87765107,87765008,87753004,87725705,87743005,87741009,87745000,87745497,87745646,87745679,87742320,87742007,87726000,87713412,87718007,87615286,87611004,87747006,87741132,87746008,87271007,87281071,87317586,87317263,87281006,87345025,87342006,87286302,87317065,87317057,87286716,87286732,87286542,87343004,87391003,87586008,87611244,87473009,87473207,87474338,87474007,87473108,87473181,87474239,87471300,87476606,87476200,87476002,87471508,87474098,87476317,87474155,87478107,87478073,87486019,87481705,87481754,87481788,87481747,87481762,87396408,87486449,87582478,87582668,87582643,87584052,87571216,87575142,87673202,87673004,87673400,87677120,87677005,87485300,87485227,87485003,87485490,87324095,87571000,87672253,87672006,87671339,87671008]

_STOP_CONNECTIONS_LIST =[[87212027, 87171926, 87192039, 87141002, 87147322, 87171009, 87182014, 87214056, 87144006, 87144451, 87141150, 87215012, 87212225, 87144014, 87172270, 87172007, 87172254, 87174003, 87174276, 87175042, 87191007, 87142109, 87193003],[87113001, 87171926, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87775007, 87773002, 87318964, 87319012, 87751008, 87722025, 87725002, 87713545, 87182014, 87214056, 87147322, 87141002, 87141150, 87215012, 87212225, 87223263, 87313882, 87271494, 87142109, 87581009, 87583005, 87575001, 87571240, 87393702, 87111849, 87471003, 87396002, 87481002, 87484006, 87192039, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87342014, 87191007, 87763029, 87703975, 87688887],[87751008, 87319012, 87318964, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87212027, 87214056, 87113001, 87171926, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87141002, 87192039, 87191007, 87723197, 87763029, 87703975, 87688887, 87773002, 87775007],[87192039, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87775007, 87773002, 87141002, 87318964, 87319012, 87751008, 87182014, 87212027, 87113001, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87725002, 87191007, 87763029, 87703975, 87688887],[87212027, 87113001, 87192039, 87141002, 87182014, 87147322, 87144006, 87144451, 87174003, 87174276, 87175042, 87191007, 87223263, 87313882, 87271494, 87142109, 87581009, 87583005, 87575001, 87571240, 87393702, 87111849, 87471003, 87396002, 87481002, 87484006, 87722025, 87723197, 87694109, 87342014],[87141002, 87113001, 87171926, 87212027, 87144006, 87144451, 87215012, 87212225, 87141150, 87144014, 87192039, 87191007, 87581009, 87583005, 87575001, 87571240, 87393702, 87111849, 87142109, 87223263, 87271494],[87113001],[87113001, 87214056, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87775007, 87773002, 87171926, 87147322, 87191007, 87212027, 87182014, 87763029, 87318964, 87319012, 87751008, 87703975, 87688887],[87113001, 87192039, 87171926, 87147322, 87212027, 87182014, 87182063, 87300822, 87300863, 87713040, 87723197, 87763029, 87318964, 87319012, 87751008, 87725689, 87703975, 87688887, 87214056, 87773002, 87775007],[87751008, 87319012, 87318964, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87723197, 87111849, 87271494, 87313882, 87342014, 87286005, 87345009, 87481002, 87484006, 87396002, 87393702, 87487603, 87571240, 87471003, 87478404, 87694109, 87171926, 87141002, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87686006, 87725705, 87763029, 87775007, 87773002, 87773200, 87781005, 87781104, 87615286, 87611004, 87703975, 87688887, 87223263],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87763029, 87223263, 87313882, 87271494, 87111849, 87703975, 87688887, 87286005, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87345009, 87722025, 87481002, 87484006, 87487603, 87571240, 87393702, 87396002, 87413013, 87411017, 87381509, 87393009, 87393579, 87471003, 87478404, 87694109, 87171926, 87686006, 87725705, 87726000, 87773200, 87781005, 87781104, 87615286, 87611004, 87286542, 87741009, 87742007, 87725002, 87781278, 87784009, 87191007, 87182014],[87722025, 87723197, 87111849, 87171926, 87141002, 87686006, 87725705, 87726000, 87223263, 87342014, 87313882, 87271494],[87223263, 87313882, 87271494, 87723197, 87763029, 87318964, 87751008, 87319012, 87703975, 87688887, 87775007, 87773002, 87286005, 87393702, 87571240, 87575001, 87583005, 87581009, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87713131, 87713040, 87300863, 87300822, 87182063, 87345009, 87722025, 87396002, 87471003, 87484006, 87481002, 87478404, 87171926, 87147322, 87142109, 87212027, 87694109, 87141002, 87286542, 87762906, 87773200, 87781278, 87781005, 87781104, 87784009],[87147322, 87113001, 87214056, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87318964, 87319012, 87751008, 87171926, 87212027, 87144006, 87144451, 87141150, 87215012, 87212225, 87144014, 87722025, 87694109, 87111849, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87725002, 87713545, 87182014],[87212027, 87300822, 87300863, 87713040, 87725689, 87723197, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87722025, 87725002, 87713545, 87182014, 87286005, 87271494, 87111849, 87713131, 87223263, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87686006, 87191007, 87763029, 87703975, 87688887],[87212027, 87182063, 87300863, 87713040, 87725689, 87723197, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87722025, 87725002, 87713545, 87182014, 87286005, 87271494, 87111849, 87713131, 87223263, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87686006, 87191007, 87763029, 87703975, 87688887],[87212027, 87182063, 87300822, 87713040, 87725689, 87723197, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87722025, 87725002, 87713545, 87182014, 87286005, 87271494, 87111849, 87713131, 87223263, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87686006, 87718007, 87191007, 87763029, 87703975, 87688887],[87212027, 87182063, 87300822, 87300863, 87725689, 87723197, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87722025, 87725002, 87713545, 87182014, 87286005, 87271494, 87111849, 87713131, 87223263, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87686006, 87718007, 87713412, 87191007, 87763029, 87703975, 87688887],[87212027, 87182063, 87300822, 87300863, 87713040, 87723197, 87775007, 87773002, 87192039, 87214056, 87318964, 87319012, 87751008, 87141002, 87722025, 87725002, 87713545, 87182014, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87191007, 87763029, 87703975, 87688887],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87773002, 87192039, 87214056, 87223263, 87271494, 87111849, 87763029, 87286005, 87471003, 87478404, 87393702, 87396002, 87686006, 87784009, 87781104, 87781005, 87781278, 87773200, 87615286, 87611004, 87722025, 87762906, 87182014, 87191007],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87775007, 87192039, 87214056, 87223263, 87271494, 87111849, 87763029, 87286005, 87471003, 87478404, 87393702, 87396002, 87686006, 87784009, 87781104, 87781005, 87781278, 87773200, 87615286, 87611004, 87722025, 87762906, 87182014, 87191007],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87319012, 87751008, 87141002, 87214056, 87722025, 87725002, 87713545, 87182014, 87763029, 87223263, 87313882, 87271494, 87111849, 87286005, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87342014, 87345009, 87481002, 87484006, 87396002, 87393702, 87413013, 87411017, 87381509, 87393009, 87393579, 87471003, 87478404, 87571240, 87686006, 87762906, 87755629, 87756486, 87286542, 87191007, 87192039],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87318964, 87751008, 87141002, 87214056, 87722025, 87725002, 87713545, 87182014, 87223263, 87313882, 87271494, 87111849, 87286005, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87763029, 87342014, 87345009, 87481002, 87484006, 87396002, 87393702, 87471003, 87478404, 87686006, 87762906, 87755629, 87286542, 87191007, 87192039],[87212027, 87182063, 87300822, 87300863, 87713040, 87725689, 87723197, 87318964, 87319012, 87141002, 87214056, 87722025, 87725002, 87713545, 87182014, 87763029, 87223263, 87313882, 87271494, 87111849, 87286005, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87342014, 87345009, 87481002, 87484006, 87396002, 87393702, 87413013, 87411017, 87381509, 87393009, 87393579, 87471003, 87478404, 87571240, 87686006, 87762906, 87755629, 87756486, 87286542, 87191007, 87192039],[87751008, 87319012, 87318964, 87722025, 87725689, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87141002, 87686006, 87713131, 87723197, 87214056],[87723197, 87318964, 87751008, 87223263, 87313882, 87271494, 87111849, 87703975, 87688887, 87775007, 87773002, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87286005, 87319012, 87481002, 87484006, 87487603, 87571240, 87393702, 87396002, 87413013, 87411017, 87381509, 87393009, 87393579, 87471003, 87478404, 87686006, 87784009, 87781104, 87781005, 87781278, 87773200, 87753004, 87765008, 87765107, 87762906, 87615286, 87611004, 87722025, 87286542, 87191007, 87192039, 87212027, 87182014, 87182063, 87300822, 87300863, 87713040, 87725689, 87214056],[87751008, 87319012, 87318964, 87722025, 87725689, 87725002, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87756056, 87757674, 87757625, 87757526, 87755447, 87755009, 87141002, 87686006, 87713131],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755009, 87755447, 87757526, 87757625, 87757674, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87756486, 87762906],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755009, 87755447, 87757526, 87757625, 87756056, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87756486, 87762906],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755009, 87755447, 87757526, 87757674, 87756056, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87756486, 87762906],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755009, 87755447, 87757625, 87757674, 87756056, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87756486, 87762906],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755009, 87757526, 87757625, 87757674, 87756056, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87762906],[87223263, 87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87755447, 87757526, 87757625, 87757674, 87756056, 87319012, 87722025, 87725689, 87725002, 87713545, 87713040, 87300863, 87300822, 87182063, 87182014, 87212027, 87141002, 87214056, 87686006, 87755629, 87756486, 87762906],[87113001, 87171926, 87141002, 87144006, 87147322],[87113001, 87171926, 87141002, 87144451, 87147322],[87113001, 87147322, 87141002, 87141150],[87113001, 87141002, 87215012, 87212225, 87212027, 87147322, 87144014],[87113001, 87141002, 87141150, 87215012, 87212027, 87147322],[87113001, 87141002, 87141150, 87212225, 87212027, 87147322],[87113001, 87171926, 87174276, 87175042],[87113001, 87171926, 87174003, 87175042],[87113001, 87171926, 87174003, 87174276],[87113001, 87172270, 87172007, 87172254],[87113001, 87171009, 87172007, 87172254],[87113001, 87171009, 87172270, 87172254],[87113001, 87171009, 87172270, 87172007],[87313882, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87319012, 87703975, 87688887, 87775007, 87773002, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87182063, 87300822, 87300863, 87713040, 87713131, 87393702, 87571240, 87575001, 87583005, 87581009, 87396002, 87471003, 87478404, 87171926, 87142109, 87212027, 87281006, 87271007, 87317586, 87281071, 87345009, 87317057, 87317065, 87317263, 87722025, 87484006, 87481002, 87773200, 87781278, 87781005, 87781104, 87784009, 87694109, 87147322],[87223263, 87271494, 87111849, 87723197, 87763029, 87318964, 87751008, 87319012, 87688887, 87703975, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87345009, 87286005, 87722025, 87393702, 87571240, 87575001, 87583005, 87581009, 87396002, 87484006, 87481002, 87478404, 87471003, 87171926, 87142109, 87212027, 87286542, 87762906, 87694109, 87784009, 87781104, 87781005, 87781278, 87773200],[87223263, 87313882, 87111849, 87723197, 87763029, 87318964, 87751008, 87319012, 87703975, 87688887, 87286005, 87775007, 87773002, 87393702, 87571240, 87575001, 87583005, 87581009, 87342014, 87755009, 87755447, 87757526, 87757625, 87757674, 87756056, 87713131, 87713040, 87300863, 87300822, 87182063, 87345009, 87722025, 87396002, 87471003, 87484006, 87481002, 87478404, 87171926, 87142109, 87212027, 87286542, 87762906, 87773200, 87781278, 87781005, 87781104, 87784009, 87694109, 87147322],[87688887, 87703975, 87763029, 87723197, 87111849, 87271494, 87313882, 87223263, 87751008, 87319012, 87318964, 87345009, 87286005, 87722025, 87393702, 87571240, 87575001, 87583005, 87581009, 87396002, 87484006, 87481002, 87271007, 87343004, 87345025, 87286542, 87286732, 87286716, 87281006, 87286302, 87342006, 87317586, 87281071, 87317057, 87317065, 87317263, 87694109, 87784009, 87781104, 87781005, 87781278, 87773200, 87171926, 87142109, 87212027],[87223263, 87271494, 87111849, 87723197, 87763029, 87688887, 87313882, 87342014, 87481002, 87484006, 87487603, 87571240, 87393702, 87396002, 87686006, 87773200, 87781278, 87781005, 87781104, 87784009, 87611004, 87615286, 87722025, 87762906, 87286005, 87286542, 87191007, 87192039, 87212027, 87182014, 87182063, 87300822, 87300863, 87713040, 87725689, 87214056],[87223263, 87271494, 87111849, 87723197, 87763029, 87703975, 87313882, 87342014, 87481002, 87484006, 87487603, 87571240, 87393702, 87396002, 87686006, 87773200, 87781278, 87781005, 87781104, 87784009, 87611004, 87615286, 87722025, 87762906, 87286005, 87286542, 87191007, 87192039, 87212027, 87182014, 87182063, 87300822, 87300863, 87713040, 87725689, 87214056],[87784009, 87781104, 87781005, 87781278, 87773002, 87775007, 87763029, 87686006, 87703975, 87688887, 87723197, 87615286, 87611004, 87722025, 87223263, 87271494, 87111849, 87313882, 87342014],[87784009, 87781104, 87781005, 87773200, 87773002, 87775007, 87763029, 87686006, 87703975, 87688887, 87223263, 87271494, 87111849, 87723197, 87313882, 87342014],[87784009, 87781104, 87781278, 87773200, 87773002, 87775007, 87763029, 87686006, 87703975, 87688887, 87723197, 87615286, 87611004, 87722025, 87223263, 87271494, 87111849, 87313882, 87342014],[87784009, 87781005, 87781278, 87773200, 87773002, 87775007, 87763029, 87686006, 87703975, 87688887, 87723197, 87615286, 87611004, 87722025, 87223263, 87271494, 87111849, 87313882, 87342014],[87781104, 87781005, 87781278, 87773200, 87773002, 87775007, 87763029, 87686006, 87703975, 87688887, 87223263, 87271494, 87111849, 87723197, 87313882, 87342014],[87271494, 87723197, 87111849, 87393702, 87571240, 87575001, 87583005, 87581009, 87318964, 87319012, 87751008, 87713131, 87713040, 87300863, 87300822, 87182063, 87773002, 87775007, 87763029, 87313882, 87342014, 87345009, 87722025, 87396002, 87471003, 87484006, 87481002, 87271007, 87286542, 87286732, 87286716, 87762906, 87688887, 87703975],[87286005, 87271494, 87111849, 87713040, 87300863, 87300822, 87182063, 87223263, 87686006, 87718007, 87713412, 87713545, 87725002],[87751008, 87319012, 87318964, 87723197, 87111849, 87271494, 87313882, 87342014, 87286005, 87722025, 87393702, 87571240, 87575001, 87583005, 87581009, 87396002, 87484006, 87481002, 87343004, 87271007, 87345025, 87317586, 87281071, 87223263, 87317263],[87286005, 87271494, 87111849, 87571240, 87575001, 87583005, 87581009, 87223263, 87345009, 87342014, 87313882, 87396002, 87471003, 87484006, 87481002, 87478404, 87487603, 87723197, 87763029, 87703975, 87688887, 87318964, 87319012, 87751008, 87722025, 87775007, 87773002, 87171926, 87147322, 87142109, 87212027, 87391003, 87286542, 87586008, 87611004, 87673202, 87672006, 87671339, 87671008, 87672253],[87286005, 87271494, 87111849, 87393702, 87575001, 87583005, 87581009, 87223263, 87345009, 87342014, 87313882, 87484006, 87481002, 87487603, 87723197, 87763029, 87703975, 87688887, 87722025, 87751008, 87318964, 87171926, 87147322, 87142109, 87212027, 87391003, 87286542, 87571216, 87575142, 87571000, 87324095, 87485003, 87485227, 87485300, 87485490, 87582668, 87582643, 87582478, 87584052],[87286005, 87271494, 87111849, 87393702, 87571240, 87583005, 87581009, 87223263, 87345009, 87342014, 87313882, 87171926, 87147322, 87142109, 87212027, 87391003, 87286542, 87575142, 87571216, 87324095, 87485003, 87485227, 87485300, 87485490, 87584052],[87286005, 87271494, 87111849, 87393702, 87571240, 87575001, 87581009, 87223263, 87345009, 87342014, 87313882, 87171926, 87147322, 87142109, 87212027, 87391003, 87286542, 87571216, 87575142, 87582668, 87582643, 87582478, 87584052],[87286005, 87271494, 87111849, 87393702, 87571240, 87575001, 87583005, 87223263, 87345009, 87342014, 87313882, 87171926, 87147322, 87142109, 87212027, 87391003, 87286542, 87586008, 87611244, 87611004, 87673202, 87673004, 87673400, 87677120, 87677005, 87571216, 87575142, 87582668, 87582478, 87582643, 87584052, 87671008, 87671339, 87672006, 87672253],[87223263, 87271494, 87111849, 87393702, 87471003, 87286005, 87342014, 87313882, 87484006, 87481002, 87345009, 87478404, 87723197, 87318964, 87319012, 87751008, 87722025, 87763029, 87703975, 87688887, 87775007, 87773002, 87212027, 87142109, 87171926, 87391003, 87471508, 87478107, 87478073, 87473108, 87473009, 87473207, 87474338, 87474007, 87476002, 87476606, 87471300, 87476200, 87396408, 87481788, 87481754, 87481705, 87481747, 87481762, 87486449, 87486019],[87286005, 87342014, 87313882, 87271494, 87111849, 87393702, 87396002, 87481002, 87345009, 87571240, 87487603, 87723197, 87763029, 87703975, 87688887, 87318964, 87319012, 87751008, 87722025, 87171926, 87142109, 87212027, 87391003, 87396408, 87481705, 87481788, 87481754, 87481747, 87481762, 87486449, 87486019, 87223263],[87286005, 87342014, 87313882, 87271494, 87111849, 87393702, 87396002, 87484006, 87345009, 87571240, 87487603, 87723197, 87763029, 87703975, 87688887, 87318964, 87319012, 87751008, 87722025, 87171926, 87142109, 87212027, 87391003, 87396408, 87481705, 87481788, 87481754, 87481762, 87481747, 87486449, 87486019, 87223263],[87223263, 87271494, 87111849, 87393702, 87396002, 87286005, 87313882, 87478404, 87723197, 87318964, 87751008, 87319012, 87763029, 87775007, 87773002, 87722025, 87171926, 87142109, 87212027, 87391003, 87471508, 87478107, 87478073, 87473009, 87473207, 87474338, 87474007, 87476606, 87474098, 87476002, 87476200, 87471300, 87473108, 87474239, 87473181, 87474155, 87476317],[87223263, 87313882, 87271494, 87111849, 87393702, 87396002, 87471003, 87723197, 87763029, 87775007, 87773002, 87722025, 87318964, 87319012, 87751008, 87391003, 87471508, 87478107, 87478073, 87474007, 87474338, 87473207, 87473009, 87473108, 87474098, 87476002, 87476200, 87476606, 87471300, 87474155],[87411017, 87381509, 87393009, 87393579, 87723197, 87763029, 87318964, 87751008],[87413013, 87381509, 87393009, 87393579, 87723197, 87763029, 87318964, 87751008],[87413013, 87411017, 87393009, 87393579, 87723197, 87763029, 87318964, 87751008],[87413013, 87411017, 87381509, 87393579, 87723197, 87763029, 87318964, 87751008],[87413013, 87411017, 87381509, 87393009, 87723197, 87763029, 87318964, 87751008],[87481002, 87484006, 87571240, 87393702, 87723197, 87763029, 87703975, 87688887, 87722025],[87223263, 87313882, 87271494, 87171926, 87212027, 87581009, 87583005, 87575001, 87571240, 87393702, 87111849, 87147322, 87471003, 87396002, 87481002, 87484006, 87113001, 87342014],[87751008, 87319012, 87318964, 87773002, 87775007, 87763029, 87784009, 87781104, 87781005, 87781278, 87773200, 87688887, 87703975, 87756056, 87757674, 87757625, 87757526, 87755009, 87762906, 87755629, 87755447, 87756486, 87761007, 87764001, 87765107, 87765008, 87753004, 87725705, 87741009, 87742320, 87742007, 87743005, 87745000, 87745497, 87745646, 87745679, 87694109, 87723197, 87722025, 87726000, 87182063, 87300822, 87300863, 87713040, 87713131, 87718007, 87713412, 87713545, 87725002, 87747006, 87741132, 87746008],[87755009, 87751008, 87319012, 87318964, 87686006],[87686006, 87318964, 87319012, 87751008, 87761007, 87764001, 87765107, 87765008, 87753004, 87763029, 87747006, 87741009, 87741132, 87746008, 87271494, 87111849, 87286005, 87313882, 87755009, 87757526, 87757625, 87757674, 87756056, 87755447, 87688887, 87703975, 87773002, 87775007, 87742007, 87742320],[87756056, 87757674, 87757625, 87757526, 87755009, 87751008, 87686006, 87318964],[87686006, 87762906, 87764001, 87765107, 87765008, 87753004, 87725705],[87686006, 87762906, 87761007, 87765107, 87765008, 87753004, 87725705],[87686006, 87762906, 87761007, 87764001, 87765008, 87753004, 87763029, 87725705],[87686006, 87762906, 87761007, 87764001, 87765107, 87753004, 87763029, 87725705],[87686006, 87762906, 87761007, 87764001, 87765107, 87765008, 87763029, 87725705],[87753004, 87765008, 87765107, 87764001, 87761007, 87686006, 87743005, 87741009, 87745497, 87745000, 87745679, 87745646, 87722025, 87723197, 87694109, 87726000, 87741132, 87746008, 87742007, 87742320],[87741009, 87686006, 87725705],[87686006, 87742320, 87742007, 87743005, 87725705, 87741132, 87746008, 87762906, 87723197],[87686006, 87745497, 87725705, 87745646, 87745679],[87686006, 87745000, 87725705, 87745646, 87745679],[87686006, 87745000, 87745497, 87745679, 87725705],[87686006, 87745000, 87745497, 87745646, 87725705],[87686006, 87741009, 87742007, 87725705, 87762906],[87686006, 87741009, 87742320, 87725705, 87723197, 87762906, 87741132, 87747006],[87686006, 87694109, 87723197, 87725705],[87686006, 87713131, 87713040, 87718007],[87686006, 87713131, 87713040, 87300863, 87713412],[87723197, 87763029, 87775007, 87773002, 87773200, 87781005, 87781104, 87611004, 87722025, 87688887, 87703975],[87723197, 87763029, 87775007, 87773002, 87773200, 87781005, 87781104, 87615286, 87722025, 87688887, 87703975, 87391003, 87581009, 87586008, 87611244, 87393702],[87762906, 87686006, 87742007],[87686006, 87725705, 87746008, 87741009, 87762906, 87742007],[87686006, 87725705, 87741132, 87741009, 87762906],[87286005, 87342014, 87343004, 87345009, 87345025, 87286542, 87286732, 87286716, 87281006, 87223263, 87286302, 87342006, 87317586, 87281071, 87317057, 87317065, 87317263],[87317586, 87223263, 87342014, 87271007, 87345009, 87317057, 87317065, 87317263],[87281071, 87223263, 87342014, 87271007, 87345009, 87317057, 87317065],[87281071, 87223263, 87345009, 87342014, 87271007],[87223263, 87342014, 87271007, 87286302, 87342006, 87345025],[87271007, 87342014, 87345009, 87343004, 87281006, 87286302, 87342006],[87281006, 87286302, 87345025, 87342014, 87271007],[87281006, 87342006, 87345025, 87342014, 87271007],[87317057, 87317586, 87281071, 87223263, 87342014, 87271007],[87317065, 87317586, 87281071, 87223263, 87342014, 87271007],[87286542, 87286732, 87286005, 87342014, 87271007],[87286542, 87286716, 87286005, 87342014, 87271007],[87286732, 87286716, 87286005, 87342014, 87271007, 87581009, 87583005, 87575001, 87571240, 87393702, 87111849, 87271494, 87313882, 87751008, 87319012, 87318964, 87723197, 87763029, 87703975, 87688887],[87342014, 87271007, 87345009, 87345025],[87393702, 87478404, 87471003, 87396002, 87484006, 87481002, 87581009, 87583005, 87575001, 87571240, 87586008, 87611244, 87611004, 87471508, 87478107, 87478073, 87396408, 87473009, 87473207, 87474338, 87474007, 87476606, 87471300, 87476200, 87476002, 87474098, 87673202, 87673004, 87673400, 87677120, 87677005, 87575142, 87571216, 87571000, 87324095, 87485003, 87485300, 87485490, 87485227, 87582668, 87582478, 87582643, 87584052, 87671008, 87671339, 87672006, 87672253, 87473108, 87474239, 87473181, 87474155, 87476317, 87481705, 87481788, 87481754, 87481762, 87481747, 87486449, 87486019],[87391003, 87581009, 87611244, 87611004, 87393702],[87391003, 87581009, 87586008, 87611004],[87391003, 87471003, 87473207, 87474338, 87474007, 87396002, 87473108, 87478404, 87474239, 87473181],[87391003, 87471003, 87473009, 87474338, 87474007, 87396002, 87473108, 87478404, 87474239, 87473181],[87391003, 87471003, 87473009, 87473207, 87474007, 87396002, 87473108, 87478404, 87474239, 87473181],[87391003, 87471003, 87473009, 87473207, 87474338, 87396002, 87473108, 87478404, 87474239, 87473181],[87391003, 87396002, 87471003, 87473009, 87473207, 87474338, 87474007, 87474239, 87473181, 87478404],[87474007, 87474239, 87474338, 87473207, 87473009, 87473108, 87471003, 87391003],[87474007, 87474338, 87473181, 87473207, 87473009, 87473108, 87471003, 87391003],[87391003, 87476606, 87476200, 87476002, 87474098, 87471003, 87474155, 87476317, 87478404, 87396002],[87471003, 87391003, 87471300, 87476200, 87476002, 87474098, 87474155, 87476317, 87478404, 87396002, 87471508],[87391003, 87471300, 87476606, 87476002, 87474098, 87471003, 87474155, 87476317, 87478404, 87396002, 87471508],[87391003, 87471300, 87476606, 87476200, 87474098, 87471003, 87474155, 87476317, 87478404, 87396002, 87471508],[87391003, 87478404, 87471003, 87396002, 87478073, 87478107, 87476606, 87476200, 87476002],[87476002, 87476200, 87476606, 87471300, 87471003, 87391003, 87474155, 87476317, 87478404],[87474098, 87474155, 87476002, 87476200, 87476606, 87471300, 87471003, 87391003],[87474098, 87476317, 87476002, 87476200, 87476606, 87471300, 87471003, 87391003, 87478404],[87478073, 87471003, 87478404, 87396002, 87391003, 87471508],[87478107, 87471003, 87478404, 87396002, 87391003, 87471508],[87486449, 87481002, 87484006, 87391003, 87396002, 87396408],[87481002, 87484006, 87391003, 87481788, 87481754, 87396002, 87481762, 87481747, 87396408],[87481788, 87481705, 87481002, 87484006, 87396002, 87391003, 87481762, 87481747, 87396408],[87481754, 87481705, 87481002, 87484006, 87396002, 87391003, 87481762, 87481747, 87396408],[87481788, 87481762, 87481754, 87481705, 87481002, 87391003, 87396002, 87484006],[87481788, 87481754, 87481747, 87481705, 87481002, 87391003, 87396002, 87484006],[87481002, 87484006, 87391003, 87396002, 87481788, 87481754, 87481705, 87486019, 87486449],[87486019, 87481002, 87484006, 87391003, 87396002, 87396408],[87582668, 87581009, 87391003, 87582643, 87583005, 87571240],[87582478, 87581009, 87391003, 87582643, 87583005, 87571240],[87582668, 87582478, 87581009, 87583005, 87571240, 87391003],[87581009, 87583005, 87575001, 87391003, 87571240, 87575142],[87391003, 87571240, 87575142, 87575001, 87571000, 87324095, 87485300, 87485003, 87485227, 87581009, 87583005],[87391003, 87575001, 87571216, 87571240, 87324095, 87583005, 87581009, 87584052],[87391003, 87581009, 87673004, 87673400, 87677120, 87677005, 87671008, 87671339, 87672006, 87672253, 87393702],[87391003, 87581009, 87673202, 87673400, 87677120, 87677005],[87391003, 87581009, 87673202, 87673004, 87677120, 87677005],[87391003, 87581009, 87673202, 87673004, 87673400, 87677005],[87391003, 87581009, 87673202, 87673004, 87673400, 87677120],[87485003, 87391003, 87485490, 87485227, 87571240, 87571000, 87571216, 87575001],[87391003, 87485490, 87485300, 87485003, 87571240, 87571000, 87571216, 87575001],[87485300, 87391003, 87485490, 87485227, 87571240, 87571000, 87571216, 87575001],[87391003, 87485300, 87485227, 87485003, 87575001, 87571240],[87391003, 87571216, 87571240, 87575142, 87575001],[87571240, 87571216, 87391003, 87485003, 87485227, 87485300],[87671008, 87671339, 87672006, 87673202, 87581009, 87391003, 87393702],[87671008, 87671339, 87672253, 87673202, 87581009, 87391003, 87393702],[87671008, 87672006, 87672253, 87673202, 87581009, 87391003, 87393702],[87671339, 87672006, 87672253, 87673202, 87581009, 87391003, 87393702]]

_STOP = {'uic':_STOP_LIST,'connections':_STOP_CONNECTIONS_LIST}

data_to_store_df = pandas.DataFrame(
        columns=["destination", "departure_date", "arrival_date", "duration", "number_of_segments", "price", "currency",
                 "transportation_mean"])

def _get_connections(station_uic_int):
    df = pandas.DataFrame(_STOP,columns=['uic','connections'])
    for index,row in df.iterrows():
        if row['uic'] == station_uic_int:
            return row['connections']
    return []

def _get_all_stations():
    return _STOP_LIST

def _string_from_datetime(date_datetime):
    date = date_datetime
    string = str(date.day)+"/"+str(date.month)+"/"+str(date.year)+" "+str(date.hour)+":"+str(date.minute)
    # DD/MM/YYYY HH:mm
    return string

def import_trip(*args):
    print('Start batch to import trip prices...')
    start = time.time()
    if len(args) == 0:
        print('No args found. Exit')
        raise ValueError
    #get date from arguments
    if isinstance(args[0], datetime.datetime):
        date = args[0]
    else:
        raise ValueError

    if len(args) > 1:
        #case 1: treat one uic
        if isinstance(args[1], int):
            departure_id = args[1]
            print('Import price for station n°',args[1],'...')
            connections = _get_connections(departure_id)
            data_to_store_df.append(get_trip_information(departure_id,connections,date))
            print(time.time() - start)

        #case 2: treat a list of uic
        elif isinstance(args[1], list):
            departure_id = args[1]
            print('Import price for stations', args[1], '...')
            for station in args[1]:
                connections = _get_connections(station)
                data_to_store_df.append(get_trip_information(station, connections,date))
                print(time.time() - start)
        #case 3: treat all station
        else:
            print('Import price for all stations...')
            for station in _get_all_stations():
                connections = _get_connections(station)
                data_to_store_df.append(get_trip_information(station, connections, date))
                print(time.time() - start)
    else:
        print('Import price for all stations...')
        for station in _get_all_stations():
            connections = _get_connections(station)
            data_to_store_df.append(get_trip_information(station, connections, date))
            print(time.time()-start)
    print(time.time() - start)
    data_to_store_df.to_csv('../temp/tl_export_{}.csv'.format(datetime),header=True,index=False,sep=';')

def get_trip_information(departure_uic_int,connections_uic_list_int,from_date,*args):
    #dataframe to retrieve results from api request
    query_df = pandas.DataFrame(
        columns=["destination", "departure_date", "arrival_date", "duration", "number_of_segments", "price", "currency",
                 "transportation_mean"])

    for connection_stop in connections_uic_list_int:
        looptime = time.time()
        try:
            from_date_str = _string_from_datetime(from_date.replace(month=5,day=1,hour=00,minute=00))
            #determine time range
            if len(args) == 0:
                to_date_str = _string_from_datetime(from_date.replace(month=5,day=1,hour=23,minute=59))
            else:
                to_date_str = _string_from_datetime(args[0])
            print("look for results from",from_date_str," to ",to_date_str)
            #search
            resultats = search(
                departure_station=str(departure_uic_int),
                arrival_station=str(connection_stop),
                from_date=from_date_str,
                to_date=to_date_str)
            #retrieve result
            query_df = resultats.df()
            query_df = query_df.fillna(connection_stop)
            print("trip [",str(departure_uic_int),"->",str(connection_stop), "] terminé")
            action_time = time.time() - looptime
            print("Temps total requête : ", action_time)
        except requests.ConnectionError:
            print(str(connection_stop), " : aucun voyage possible")
            action_time = time.time() - looptime
            print("Temps total requête (Error - connection) : ", action_time)
            pass

        except TimeoutError:
            action_time = time.time() - looptime
            print("Temps total requête (error - TimeOut) : ", action_time)
            pass

    return query_df

