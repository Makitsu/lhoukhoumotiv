import pandas as pd
import io
import requests
import numpy

_STATIONS_CSV_FILE = "https://raw.githubusercontent.com/\
trainline-eu/stations/master/stations.csv"

_STOP_UIC = [87113001,87212027,87182014,87171926,87147322,87193003,87192039,87191007,87722025,87723197,87694109,87111849,87141002,87182063,87300822,87300863,87713040,87725689,87775007,87773002,87318964,87319012,87751008,87725002,87763029,87713545,87756056,87757674,87757625,87757526,87755447,87755009,87144451,87144006,87144014,87141150,87212225,87215012,87174003,87174276,87175042,87171009,87172270,87172007,87172254,87223263,87313882,87001479,87342014,87703975,87688887,87773200,87781278,87781005,87781104,87784009,87286005,87713131,87345009,87393702,87571240,87575001,87583005,87581009,87396002,87484006,87481002,87471003,87478404,87413013,87411017,87381509,87393009,87393579,87487603,87142109,87686006,87755629,87762906,87756486,87761007,87764001,87765107,87765008,87753004,87725705,87743005,87741009,87745000,87745497,87745646,87745679,87742320,87742007,87726000,87713412,87718007,87615286,87611004,87747006,87741132,87746008,87271007,87281071,87317586,87317263,87281006,87345025,87342006,87286302,87317065,87317057,87286716,87286732,87286542,87343004,87391003,87586008,87611244,87473009,87473207,87474338,87474007,87473108,87473181,87474239,87471300,87476606,87476200,87476002,87471508,87474098,87476317,87474155,87478107,87478073,87486019,87481705,87481754,87481788,87481747,87481762,87396408,87486449,87582478,87582668,87582643,87584052,87571216,87575142,87673202,87673004,87673400,87677120,87677005,87485300,87485227,87485003,87485490,87324095,87571000,87672253,87672006,87671339,87671008]

df_connections = pd.read_csv('connections.csv',sep=';')

csv_content = requests.get(_STATIONS_CSV_FILE).content
df = pd.read_csv(io.StringIO(csv_content.decode('utf-8')),
                 sep=';', index_col=0, low_memory=False)
#df = df[df.is_suggestable == 't']
#df = df[df.country == 'FR']
df_mini = df.filter(['name','uic8_sncf'])
df_mini= df_mini[~numpy.isnan(df_mini['uic8_sncf'])]
df_mini['uic8_sncf'] =df_mini['uic8_sncf'].astype(int)
#df_mini = df_mini.join(df.filter(['uic8_sncf']))
df_mini['name'] = df_mini['name'].str.lower()

res=[]
for index,row in df_connections.iterrows():
    list = df_mini[df_mini['uic8_sncf']==row['stop_uic']].index.values
    if len(list) == 0 :
        list=[-1]

    res.append(list[0])
df_connections['code_tl'] = res


test = {'id':[],'uic':[]}
for uic in _STOP_UIC:
    print(uic)

    id = next(iter(df_mini[df_mini['uic8_sncf'] == uic].index), 'no match')
    print(id)
    test['id'].append(id)
    test['uic'].append(id)

test_df = pd.DataFrame(test,columns=['id'])
test_df.to_csv("id_tl.csv",sep=';',index=False)

df_mini.to_csv("stations_mini5.csv", sep=';', encoding='utf-8', header=False, index=True)